pipeline {
    environment {
        registry = "abdelaliabia99/tp2"  
        registryCredential = '2951d918-030d-42a7-9ef6-4e6d5306eff0'  
        dockerImage = ''  
    }
    agent any  
    stages {
        stage('Cloning Git') {  
            }
        }
        stage('Building image') {  
            steps {
                script {
                    dockerImage = docker.build registry + ":$BUILD_NUMBER" 
                }
            }
        }
        stage('Test image') {  
            steps {
                script {
                    echo "Tests passed"  
                }
            }
        }
        stage('Publish Image') {  
            steps {
                script {
                    docker.withRegistry('', registryCredential) {  
                        dockerImage.push()  
                    }
                }
            }
        }
        stage('Deploy image') {  
            steps {
                script {
    
                    sh "docker run -d --name tp2_app -p 8080:80 ${registry}:$BUILD_NUMBER"
                }
            }
        }
    }
